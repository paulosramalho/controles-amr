generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ModeloPagamento {
  AVISTA
  ENTRADA_E_PARCELAS
  PARCELAS
}

enum StatusOrdem {
  ATIVA
  CONCLUIDA
  SUSPENSA
  CANCELADA
}

enum StatusPagamento {
  EM_ABERTO
  PAGO
  PARCIAL
  CANCELADO
}

enum TipoAdvogado {
  SOCIO_PATRIMONIAL
  SOCIO_SERVICO
  ASSOCIADO
  CORRESPONDENTE
  OUTRO
}

enum OrigemRepasse {
  INCIDENTAL
  MENSAL_RECORRENTE
  DISTRIBUICAO_LUCRO
  OUTRA
}

enum PerfilUsuario {
  ADMIN
  FINANCEIRO
  OPERACIONAL
  LEITURA
}

model Cliente {
  id              Int              @id @default(autoincrement())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  cpfCnpj         String
  nomeRazaoSocial String
  email           String?
  telefone        String?
  observacoes     String?
  ativo           Boolean          @default(true)

  ordens          OrdemPagamento[]
}

model OrdemPagamento {
  id                 Int              @id @default(autoincrement())
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  clienteId          Int
  cliente            Cliente          @relation(fields: [clienteId], references: [id])

  // Sequência de ocorrência (ordem) dentro do cliente
  sequenciaCliente   Int
  codigoInterno      String?
  descricao          String?
  tipoContrato       String?
  valorTotalPrevisto Decimal?
  modeloPagamento    ModeloPagamento
  dataInicio         DateTime
  dataFimPrevista    DateTime?
  status             StatusOrdem

  pagamentos         Pagamento[]
  repasses           Repasse[]
}

model Pagamento {
  id                 Int              @id @default(autoincrement())
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  ordemPagamentoId   Int
  ordemPagamento     OrdemPagamento   @relation(fields: [ordemPagamentoId], references: [id])

  numeroParcela      Int              // 0 = entrada, 1, 2, 3...
  dataPrevista       DateTime
  dataEfetiva        DateTime?
  valorPrevisto      Decimal
  valorPago          Decimal?
  formaPagamento     String?
  status             StatusPagamento
  observacoes        String?
}

model Advogado {
  id               Int          @id @default(autoincrement())
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  nome             String
  cpf              String?
  email            String?
  telefone         String?
  tipo             TipoAdvogado
  possuiFixoMensal Boolean      @default(false)
  valorFixoMensal  Decimal?
  ativo            Boolean      @default(true)

  repasses         Repasse[]
}

model Repasse {
  id                        Int             @id @default(autoincrement())
  createdAt                 DateTime        @default(now())
  updatedAt                 DateTime        @updatedAt

  advogadoId                Int
  advogado                  Advogado        @relation(fields: [advogadoId], references: [id])

  ordemPagamentoId          Int?
  ordemPagamento            OrdemPagamento? @relation(fields: [ordemPagamentoId], references: [id])

  referenciaCompetencia     String          // ex.: "2025-01"
  valorDevido               Decimal
  valorPago                 Decimal?
  dataPagamento             DateTime?
  saldoAReceber             Decimal?
  origem                    OrigemRepasse
  modeloDistribuicaoCodigo  String?
  observacoes               String?
}

model Estagiario {
  id                      Int       @id @default(autoincrement())
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  nome                    String
  cpf                     String?
  email                   String?
  telefone                String?
  auxilioTransporteValor  Decimal?
  auxilioEstagioValor     Decimal?
  ativo                   Boolean   @default(true)
}

model PrestadorServico {
  id               Int       @id @default(autoincrement())
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  nomeRazaoSocial  String
  cpfCnpj          String?
  tipo             String    // "secretaria_virtual", "contabilidade", "ti", ...
  valorRecorrente  Decimal?
  observacoes      String?
  ativo            Boolean   @default(true)
}

model Usuario {
  id          Int           @id @default(autoincrement())
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  nome        String
  email       String        @unique
  senhaHash   String
  perfil      PerfilUsuario
  ativo       Boolean       @default(true)
}

model ConfiguracaoCalculo {
  id                        Int      @id @default(autoincrement())
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  codigoModelo              String   @unique
  descricao                 String?
  percentualAdvogado        Decimal
  percentualSocio           Decimal
  percentualFundoReserva    Decimal
  percentualEscritorio      Decimal
  vigenciaInicio            DateTime
  vigenciaFim               DateTime?
  ativo                     Boolean  @default(true)
}

model ModeloDistribuicao {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  codigo       String   // A, B, C, ...
  origem       String   // "ESCRITÓRIO", "SÓCIO", "DISTRIBUIÇÃO DE LUCRO (FUNDO DE RESERVA)", ...
  tipo         String   // "INCIDENTAL", "MENSAL/RECORRENTE", "SEMESTRAL"
  percentual   Decimal
  destinatario String   // "FUNDO DE RESERVA", "SÓCIO", "ESCRITÓRIO", "INDICAÇÃO", ...
}
